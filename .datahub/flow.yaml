meta:
  dataset: historical-income-households-us
  findability: published
  owner: core
  ownerid: core
  version: 1
inputs:
- kind: datapackage
  url: https://raw.githubusercontent.com/anuveyatsu/historical-income-households-us/master/datapackage.json
  parameters:
    resource-mapping: {}
    descriptor:
      name: historical-income-households-us
      title: Income Limits for Each Fifth and Top 5 Percent of All Households:  1967 to 2016
      description: Households as of March of the following year. Income in current and 2016 CPI-U-RS adjusted dollars.
      sources:
        -
          path: https://www2.census.gov
          title: United States Census Bureau
      resources:
        -
          name: historical-income-households-us
          pathType: remote
          path: https://www2.census.gov/programs-surveys/cps/tables/time-series/historical-income-households/h01ar.xls
          format: xls
      views:
        - 
          name: comparison-of-upper-limit-of-each-fifth-and-lower-limit-of-top-5-percent
          title: Comparison of upper limit of each fifth and lower limit of top 5 percent
          resources:
            - historical-income-households-us
          specType: simple
          spec:
            type: line
            group: Year
            series:
              - Lowest
              - Second
              - Third
              - Fourth
              - Top 5 percent
        - 
          name: lowest-fifth-vs-top-5-percent
          title: Ratio of lower limit of top 5 percent to upper limit of lowest fifth
          resources:
            - name: historical-income-households-us
              transform:
                - 
                  type: formula
                  expressions:
                    - data['Top 5 percent']/data['Lowest']
                  asFields:
                    - Ratio
              specType: simple
              spec:
                type: line
                group: Year
                series:
                  - Ratio 
processing:
  -
    input: historical-income-households-us
    tabulator:
      sheet: 1
      skip_rows: [1,2,3,4,5,6,11,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112]
      headers:
        - Year
        - Number (thousands)
        - Lowest
        - Second
        - Third
        - Fourth
        - Top 5 percent
    output: historical-income-households-us
    dpp:
      - run: find_replace
        parameters:
          resources: historical-income-households-us
          fields:
            -
              name: Year
              patterns:
                -
                  find: (\s?\(\d+\))|(\.0)
                  replace: ''
      - run: find_replace
        parameters:
          resources: historical-income-households-us
          fields:
            -
              name: Fourth
              patterns:
                -
                  find: \+|,
                  replace: ''
      - run: set_types
        parameters:
          resources: historical-income-households-us
          types:
            Year:
              type: year
            "^(?!Y).+":
              type: number
